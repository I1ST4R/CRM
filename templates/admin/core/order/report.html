{% extends "admin/base_site.html" %}
{% load i18n admin_urls %}

{% block content %}
<div id="content-main">
    <div class="module">
        <h2>Создание отчета по заказам</h2>
        <form method="get" action="{% url 'order_report' %}">
            <div class="form-row">
                <div class="field-box">
                    <label for="id_date_from">Дата с:</label>
                    <input type="date" name="date_from" id="id_date_from" value="{{ date_from|default:'' }}">
                </div>
                <div class="field-box">
                    <label for="id_date_to">Дата по:</label>
                    <input type="date" name="date_to" id="id_date_to" value="{{ date_to|default:'' }}">
                </div>
            </div>
            <div class="form-row">
                <div class="field-box">
                    <label for="id_client">Клиент:</label>
                    <select name="client" id="id_client">
                        <option value="">Все клиенты</option>
                        {% for client in clients %}
                            <option value="{{ client.id }}" {% if selected_client == client.id %}selected{% endif %}>
                                {{ client.name }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="submit-row">
                <input type="submit" value="Сформировать отчет" class="default">
            </div>
        </form>
    </div>

    {% if orders %}
    <div class="module">
        <h2>Результаты отчета</h2>
        <table>
            <thead>
                <tr>
                    <th>Номер заказа</th>
                    <th>Дата</th>
                    <th>Клиент</th>
                    <th>Статус</th>
                    <th>Сумма</th>
                </tr>
            </thead>
            <tbody>
                {% for order in orders %}
                <tr>
                    <td><a href="{% url 'admin:core_order_change' order.id %}">Заказ #{{ order.id }}</a></td>
                    <td>{{ order.date }}</td>
                    <td>{{ order.client.name }}</td>
                    <td>{{ order.get_status_display }}</td>
                    <td>{{ order.total_amount }} ₽</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <div class="module" style="margin-top: 20px;">
            <h3>Статистика</h3>
            <table>
                <thead>
                    <tr>
                        <th>Статус</th>
                        <th>Количество</th>
                        <th>Процент</th>
                    </tr>
                </thead>
                <tbody>
                    {% for status, count, percent in status_stats %}
                    <tr>
                        <td>{{ status }}</td>
                        <td>{{ count }}</td>
                        <td>{{ percent }}%</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <div style="margin-top: 10px; font-weight: bold;">
                Общая сумма заказов: {{ total_amount }} ₽
            </div>
        </div>
    </div>
    {% elif request.GET %}
    <div class="module">
        <p>За выбранный период заказы не найдены.</p>
    </div>
    {% endif %}
</div>

<style>
.form-row {
    padding: 10px;
    border-bottom: 1px solid #eee;
}

.field-box {
    display: inline-block;
    margin-right: 20px;
    vertical-align: top;
}

.field-box label {
    display: block;
    margin-bottom: 5px;
    color: #666;
}

.field-box input,
.field-box select {
    width: 200px;
    padding: 5px;
}

.submit-row {
    padding: 10px;
    text-align: right;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
}

th {
    background: #417690;
    color: #fff;
    padding: 8px;
    text-align: left;
    font-weight: 400;
}

td {
    padding: 8px;
    border-bottom: 1px solid #333;
    color: #fff;
}

a {
    color: #fff;
    text-decoration: none;
}

a:hover {
    color: #ccc;
}
</style>
{% endblock %} 